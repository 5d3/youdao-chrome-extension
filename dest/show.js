function createAndAppend(e,t){var n=document.createElement("li");n.innerHTML=t,e.appendChild(n)}function parseJSON(e){var t=JSON.parse(e),n=t.translateResult,r=n[0][0].src,o=n[0][0].tgt,a=document.createElement("h2");a.innerHTML=r;var d=document.createElement("ul");createAndAppend(d,o);var l=t.smartResult;if(l)for(var s=l.entries,i=1;i<s.length;i++)createAndAppend(d,s[i]);return[a,d]}function xhr(e,t){var n=new XMLHttpRequest;n.open("POST","https://fanyi.youdao.com/translate?smartresult=dict&smartresult=rule&smartresult=ugc&sessionFrom=null",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send("type=AUTO&i="+searchTxt+"&doctype=json&xmlVersion=1.8&keyfrom=fanyi.web&ue=UTF-8&action=FY_BY_ENTER&typoResult=true"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var r=parseJSON(n.responseText);e.removeChild(t);for(var o=0;o<r.length;o++)e.appendChild(r[o])}}}function loadContent(){var e=document.getElementById("btn");e.style.display="none";var t=document.getElementById("panel");if(t)for(;t.lastChild;)t.removeChild(t.lastChild);else t=document.createElement("div"),t.setAttribute("id","panel"),document.body.appendChild(t);var n=document.createElement("p");n.innerHTML="查询中，请稍后...",t.appendChild(n),xhr(t,n)}function setAttr(e,t){for(var n=0;n<t.length;n++)e.setAttribute(t[n][0],t[n][1])}function showBtn(e){var t=document.getElementById("btn");if(t)t.style.display="block";else{t=document.createElement("img");var n=[["id","btn"],["src","https://raw.githubusercontent.com/Ovilia/handian-chrome-extension/master/res/handian32.png"]];setAttr(t,n),t.style.position="absolute",t.style.pointer="cursor",t.style.zIndex="1000"}t.style.top=e.bottom+window.pageYOffset+10+"px",t.style.left=e.left+window.pageXOffset+"px",document.body.appendChild(t)}var searchTxt;document.onmouseup=function(e){return e.target===document.getElementById("btn")?void loadContent():void chrome.storage.sync.get("enableSwitch",function(e){if(e.enableSwitch){var t=window.getSelection(),n=t.toString();if(n){searchTxt=n;var r=t.getRangeAt(0).getBoundingClientRect();showBtn(r)}else{var o=document.getElementById("btn");o&&(o.style.display="none");var a=document.getElementById("panel");a&&document.body.removeChild(a)}}})};
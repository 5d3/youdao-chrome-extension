function closeYoudao(){var e=document.getElementById("youdao");e&&document.body.removeChild(e);var t=document.getElementById("youdao-btn");t&&(t.style.display="none")}function initPanel(){var e=document.createElement("div");e.setAttribute("id","youdao");var t=document.createElement("p");return t.innerHTML="查询中，请稍候...",t.setAttribute("id","youdao-loading"),e.appendChild(t),document.body.appendChild(e),e}function DOMAppend(e,t,n){e.appendChild(t).appendChild(n)}function getResult(e,t){var n,o,a=JSON.parse(t),d=a.translateResult[0][0],r=d.src,u=d.tgt,i=document.createElement("ul"),l=document.createElement("h2"),s=document.createTextNode(r);DOMAppend(e,l,s),n=document.createElement("li"),o=document.createTextNode(u),DOMAppend(i,n,o);var c=a.smartResult;if(c)for(var m=c.entries,p=1;p<m.length;p++)n=document.createElement("li"),o=document.createTextNode(m[p]),DOMAppend(i,n,o);e.appendChild(i)}function loadYoudao(){closeYoudao();var e=initPanel(),t=new XMLHttpRequest;t.open("POST","https://fanyi.youdao.com/translate?smartresult=dict&smartresult=rule&smartresult=ugc&sessionFrom=null",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("type=AUTO&i="+searchTxt+"&doctype=json&xmlVersion=1.8&keyfrom=fanyi.web&ue=UTF-8&action=FY_BY_ENTER&typoResult=true"),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var n=document.getElementById("youdao-loading");n&&e.removeChild(n),getResult(e,t.responseText)}}}var searchTxt;document.onmouseup=function(e){return e.target===document.getElementById("youdao-btn")?void loadYoudao():void chrome.storage.sync.get("enableSwitch",function(e){if(e.enableSwitch){var t=window.getSelection(),n=t.getRangeAt(0).getBoundingClientRect(),o=document.getElementById("youdao-btn");o?o.style.display="block":(o=document.createElement("img"),o.setAttribute("id","youdao-btn"),o.setAttribute("src","https://raw.githubusercontent.com/Ovilia/handian-chrome-extension/master/res/handian32.png"),o.style.position="absolute",o.style.cursor="pointer",o.style.zIndex="1000",document.body.appendChild(o)),o.style.top=n.bottom+window.pageYOffset+10+"px",o.style.left=n.left+window.pageXOffset+"px";var a=t.toString();a?searchTxt=a:closeYoudao()}else closeYoudao()})};